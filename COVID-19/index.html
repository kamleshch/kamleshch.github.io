<!DOCTYPE html>
<html>
<!-- Load d3.js -->
<script src="http://d3js.org/d3.v4.js"></script>
<link href="StyleSheet.css" rel="stylesheet">
<head><h1><center>Global COVID-19 outbreak</center></h1></head>
<body>
    <p>COVID‑19/Coronavirus pandemic is an ongoing global pandemic caused by severe acute respiratory syndrome coronavirus 2 (SARS‑CoV‑2). The outbreak was first identified in December 2019 in Wuhan, China. The World Health Organization declared the outbreak a Public Health Emergency of International Concern on 30 January 2020 and a pandemic on 11 March. Below is a snapshot of the number of confirmed cases in the world and confirmed cases in each country.
    </p>
    
<table style="width:100%">
  <tr style="text-align: center">
    <th>Total Cases</th>
    <th>Deaths</th>
    <th>Recovered</th>
  </tr>
  <tr style="text-align: center">
    <td>16 million+</td>
    <td>643,978</td>
    <td>9.2 million+</td>
  </tr>
</table>
<table style="width:100%">
    <tr>
        <th style="text-align: right; color: red">As of July 25, 2020, 11:59 P.M. E.T.</th></tr>
</table>
    
    <form action="7dayma.html" style="float: right">
        <input type="submit" value="Next"/>
    </form>
<div id="div_template" style="background-color:white" width=900 height="850"></div>

<center><svg width="1000" height="600"></svg></center>
<script>
var svg = d3.select("svg"),
  width = +svg.attr("width"),
  height = +svg.attr("height");

// Load external data and boot
    
    data = d3.csv("https://raw.githubusercontent.com/kamleshch/COVID-19/master/data/Countries_Latest_072520.csv",function(data) {
        var path = d3.geoPath();
        //add div for tooltip
        var Tooltip = d3.select("#div_template")
        .append("div").attr("width",400+"px")
        .style("opacity", 0)
        .style("background-color", "transparent").style("color","black").style("position", "relative").style("display","block")

        //add svg for the map
        var svg = d3.select("#div_template")
        .append("svg")
        .attr("height", height)
        .attr("width", width)
        .style("display","block")
        .style("margin","auto")
        
        var projection = d3.geoMercator()
        .scale(150)
  .center([0,20])
  .translate([width / 2, height / 2]);
          
        var countryArray = [];
        var lifeArray = [];
        var countryId = [];
        var k =0
        countryArray.push(data[0].Country)
        lifeArray.push(parseInt(data[0].Confirmed))
        
        //get data from csv file and add to the json opject
        l = data.length
        for(var i =1;i<l - 2;)
            {
                var Country = data[i].Country
                while(i<l -2 && Country == data[i].Country)
                    {
                        var pop_no = parseInt(data[i].Confirmed)
                        lifeArray[k] = lifeArray[k] + pop_no
                        i++
                    }
                k ++;
                countryArray.push(data[i].Country)
                lifeArray.push(parseInt(data[i].Confirmed))
                
            }
        json = d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson",function(json){
            for(j =0;j<json.features.length;j++)
                {
                    
                        json.features[j].Confirmed = 0
                    
                }

            for(i =0 ; i<countryArray.length;i++)
            {
                for(j =0;j<json.features.length;j++)
                {
                    
                    if(countryArray[i] == json.features[j].properties.name)
                    {
                        json.features[j].Confirmed = lifeArray[i]
                        break
                    }
                    
                }
            }

            let mouseOver = function(d) {
                Tooltip.style("opacity", 1)
                d3.selectAll(".Country")
                    .transition()
                    .duration(200)
                    .style("opacity", .5)
                d3.select(this)
                    .transition()
                    .duration(200)
                    .style("opacity", 1)
                    .style("stroke", "black")
            }
            let mouseLeave = function(d) {
                Tooltip.style("opacity", 0)
                d3.selectAll(".Country")
                    .transition()
                    .duration(200)
                    .style("opacity", .8)
                d3.select(this)
                    .transition()
                    .duration(200)
                    .style("stroke", "transparent")
            }
              var mousemove = function(d) {
                  var Confirmed = d.Confirmed
                  if(Confirmed == 0 || isNaN(Confirmed))
                      {
                          Confirmed = "N/A"  
                      } 
                  Tooltip
                      .html("<p>Country:"+d.properties.name+"<br>Confirmed:"+Confirmed+"</p>")
                      .style("left",(d3.mouse(this)[0])+"px")
                      .style("top", (d3.mouse(this)[1])+"px")
                  
              }
            // Draw the map
            min = d3.min(lifeArray)
            max = d3.max(lifeArray) / 16

            maxcol = "#FF1414"
            mincol="#FFEBEB"
            var colorScale = d3.scaleLinear()
            .domain([0,max])
            //.range([mincol,maxcol]);
            .range(["lightyellow","red"]);
            svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", d3.geoPath()
                      .projection(projection))
                .attr("fill", function (d,i) {
                return colorScale(json.features[i].Confirmed / 2)
                    
            })
                .style("stroke", "black")
                .attr("class", function(d){ return "Country" } )
                .style("opacity", 1)
                .on("mouseover", mouseOver)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseLeave)
             y = d3.scaleLinear().domain([0,max]).range([0,140]);

           var defs = svg.append("defs");
            
            var linearGradient = defs.append("linearGradient")
    .attr("id", "linear-gradient");
            
            //Horizontal gradient
linearGradient
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%")
                        linearGradient.append("stop")
   .attr('class', 'start')
   .attr("offset", "0%")
   .attr("stop-color", "white")
   .attr("stop-opacity", 1);
            
            linearGradient.append("stop")
   .attr('class', 'end')
   .attr("offset", "100%")
   .attr("stop-color", maxcol)
   .attr("stop-opacity", 1);
            d3.select("svg").append("rect").attr("x",20).attr("y",10).attr("width",140).attr("height",10).attr("fill","url(#linear-gradient)")
            d3.select("svg").append("g").attr("transform","translate(20,20)").call(d3.axisBottom(y)).attr("stroke","white").attr("fill","white")

       // });
        
        legend_height = 550
legend_width = 130

   
    // Linear scale for y-axis
  //  const yScale = d3.scale.Linear().domain([0, max]).range([legend_height, 0]);

//Create SVG element and append map to the SVG
var k_svg = d3.select("#my_dataviz")
.append("svg")
.attr("width", legend_width)
.attr("height", legend_height)
.attr("class", "legend")
      .attr("transform", "translate(180,-20)");

var legend = k_svg.append("defs")
           .append("svg:linearGradient")
   .attr("id", "gradient")
.attr("x1", "100%")
.attr("y1", "0%")
.attr("x2", "100%")
.attr("y2", "100%");


   legend.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "#ff0000")
                .attr("stop-opacity", 1);

            legend.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", "#ffffe0")
                .attr("stop-opacity", 1);

k_svg.append("rect")
.attr("width", legend_width-100)
.attr("height", legend_height/2)
.style("fill", "url(#gradient)")
.attr("transform", "translate(55,0)");

            var y = d3.scaleLinear().range([legend_height/2, 0]).domain([0, max]);

            var yAxis = d3.axisRight(y);

            k_svg.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(85,0)")
                .call(yAxis)
});
        });

</script>
    </body>
<footer>
  <p>Author: Kamlesh Chegondi<br>
  <a href="mailto:kamlesh2@illinois.edu">kamlesh2@illinois.edu</a></p>
</footer>
</html>
